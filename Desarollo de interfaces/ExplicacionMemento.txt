Qu√© hace el proyecto (visi√≥n general)

Es un diario de recuerdos tipo Memento donde cada recuerdo se guarda con:

campos sensoriales (vista, o√≠do, olfato, sabor, tacto‚Ä¶),

contexto (fecha/momento, ubicaci√≥n),

reflexi√≥n (lecciones),

y un ‚Äúperfil emocional‚Äù (6 emociones 0‚Äì10).

Cada recuerdo se representa en el canvas como una burbuja 3D fake:

su color interno mezcla las emociones,

su halo y su borde se basan en la emoci√≥n dominante,

su tama√±o/blur/transparencia dependen de una coordenada Z simulada,

se mueve con ‚Äúf√≠sica suave‚Äù (repulsi√≥n/atracci√≥n), y adem√°s reacciona al cursor.

El sistema ya es un CRUD completo:

Crear (formulario)

Leer (cargar y visualizar)

Editar (desde el modal, precarga formulario)

Eliminar (desde el modal)

Y adem√°s a√±ade ‚Äúfeatures de producto‚Äù:

filtros por fecha, ubicaci√≥n y emoci√≥n dominante,

exportar/importar recuerdos (portabilidad),

tooltip al hover (resumen sin abrir modal).

Estructura del c√≥digo por archivos
1) index.html

Panel izquierdo con el formulario (crear/editar).

Buscador por texto para ‚Äúconectar‚Äù recuerdos (visualiza relaciones).

Bloque nuevo de filtros + export/import.

Zona derecha (.stage-wrap) con el canvas.

Modal con contenido del recuerdo y botones nuevos: Editar y Eliminar.

A√±adido clave en HTML

<input type="hidden" id="_id"> para saber si el submit es creaci√≥n o edici√≥n.

Botones:

#saveBtn (texto cambia ‚ÄúGuardar‚Äù / ‚ÄúGuardar cambios‚Äù)

#cancelEditBtn (sale de edici√≥n)

#editBtn y #deleteBtn en el modal

#exportBtn, #importBtn e #importFile para JSON

2) guardar_recuerdos.php

Antes: solo GET (leer) y POST (a√±adir).
Ahora: API CRUD + import/export sobre recuerdos.json.

Rutas y m√©todos

GET guardar_recuerdos.php

devuelve el array completo de recuerdos.

GET guardar_recuerdos.php?download=1

igual que arriba, pero a√±ade header para descargar como archivo (Exportar).

POST guardar_recuerdos.php

crea un recuerdo nuevo (asegura _id).

PUT guardar_recuerdos.php

edita un recuerdo existente por _id (reemplazo completo del objeto).

DELETE guardar_recuerdos.php?id=...

elimina por _id.

POST guardar_recuerdos.php con { action:"import", items:[...] }

importa y deduplica por _id (si existe, actualiza; si no, inserta).

Detalles importantes

LOCK_EX al escribir JSON ‚Üí evita corrupci√≥n si hay escrituras simult√°neas.

ensure_id() ‚Üí si falta _id lo genera (robusto para imports).

3) styles.css

Mantiene tu est√©tica Naruto del panel, y mejora el escenario:

A√±adido destacado

.stage-wrap::before ‚Üí ‚Äúaura‚Äù animada (rotaci√≥n + respiraci√≥n)

.stage-wrap::after ‚Üí grain + scanlines con drift
Esto hace que el fondo ‚Äúviva‚Äù y el canvas se sienta m√°s inmersivo.

4) scripts.js (n√∫cleo: visual + l√≥gica)

Tu JS se puede entender como 6 m√≥dulos:

1) Datos emocionales + utilidades

EMO: paleta y etiquetas.

Mezcla de colores:

bubbleColorFromEmotions() genera el color resultante seg√∫n sliders.

Dominancia emocional:

dominantEmotion() devuelve emoci√≥n con valor m√°s alto ‚Üí usada para halo y borde.

Helpers: clamp01, lerp, rgbToCss.

Impacto visual

El interior de la burbuja usa el color mezcla.

El borde/halo usan el color dominante.

2) UI de emociones + voz

setupEmotionUI() sincroniza sliders con sus valores (val_*).

Voz con webkitSpeechRecognition:

cada bot√≥n üé§ escribe en su campo.

3) Modal + selecci√≥n

showMemoryModal(memory) llena el modal y guarda referencia en selectedMemory.

Botones nuevos del modal:

Editar: precarga formulario y activa modo edici√≥n.

Eliminar: llama DELETE al PHP y borra la part√≠cula en cliente.

4) Motor ‚Äúburbujas 3D fake‚Äù (canvas)
a) Profundidad simulada (Z)

Cada part√≠cula tiene z en [0..1]:

depthScale(z) ‚Üí burbuja m√°s grande si est√° ‚Äúcerca‚Äù

depthBlur(z) ‚Üí m√°s blur si est√° ‚Äúlejos‚Äù

depthAlpha(z) ‚Üí m√°s transparente si est√° ‚Äúlejos‚Äù

depthParallax(z) ‚Üí parallax m√°s fuerte si est√° ‚Äúcerca‚Äù

Adem√°s vz hace una deriva suave (no se queda congelada en el espacio).

b) Parallax del escenario

En pointermove se calcula un vector normalizado del cursor y se suaviza.

projectedPos(p) aplica ese offset en funci√≥n de Z ‚Üí da sensaci√≥n 3D.

5) F√≠sica del movimiento + cursor ‚Äúgel‚Äù

Cada part√≠cula aplica fuerzas:

a) Interacciones entre burbujas

Repulsi√≥n fuerte cerca (distMin + kRepelClose)

Repulsi√≥n media/larga (kRepelMid, kRepelOuter)

Cuando hay b√∫squeda:

‚Äúactivas‚Äù (score>0) se atraen y se agrupan hacia el centro.

b) Drift (ruido suave)

driftForce() mete oscilaci√≥n con sin/cos basada en una seed.
Resultado: nunca se quedan ‚Äúmuertas‚Äù.

c) Cursor repelente ‚Äúgel suave‚Äù

cursorForce() repele pero:

tiene dead-zone para permitir click,

se desactiva durante ~160ms tras pointerdown (freezeUntil),

y solo empuja ‚Äúbien‚Äù cuando el cursor se mueve (factor de movimiento).
Esto hace que parezca un campo de fuerza suave sin frustrar el usuario.

6) Render avanzado de burbuja

Dentro de drawBubble():

Sombra el√≠ptica ‚Üí volumen.

Base glass con gradiente radial ‚Üí vidrio.

Tint emocional en modo multiply ‚Üí color dentro.

Rim light (screen) ‚Üí borde iluminado suave.

Borde destacado:

si est√° seleccionada o matcheada, el borde usa color de emoci√≥n dominante.

Glint orbitando:

brillo principal gira lento con time + seed.

Segundo highlight:

brillo peque√±o en lado opuesto para aumentar ‚Äú3D‚Äù.

Adem√°s:

drawHalo() genera un halo pulsante (screen + blur).

drawConnections() dibuja l√≠neas entre recuerdos ‚Äúrelacionados‚Äù por b√∫squeda.

7) Tooltip (vista resumen sin modal)

En hover se detecta la part√≠cula ‚Äúm√°s cercana‚Äù (orden por z).

drawTooltip() muestra:

fecha

ubicaci√≥n

inicio de ‚Äúvista‚Äù
Esto te da una ‚Äúvista r√°pida‚Äù sin abrir modal.

8) CRUD: editar, guardar, eliminar
Edici√≥n

editingId controla si est√°s editando.

fillFormFromMemory() precarga inputs y emociones.

setFormMode(true/false) cambia t√≠tulo y botones.

Submit:

POST si es nuevo

PUT si es edici√≥n

Al editar, se actualiza:

objeto en memories

propiedades de la part√≠cula (tokens, tint, domColor, domValue, y z)

Eliminaci√≥n

DELETE guardar_recuerdos.php?id=...

se eliminan de memories y particles.

9) Filtros (sin IA, pero ‚Äúsmart‚Äù)

Se filtra a nivel cliente con p.visible:

rango de fechas (dateFrom, dateTo)

ubicaci√≥n contiene (locFilter)

emoci√≥n dominante (emoKey)

umbral m√≠nimo (emoMin)

applyFilters() marca visibles/no visibles y el render respeta eso:

no dibuja burbujas invisibles

no dibuja conexiones con invisibles

hover/click tambi√©n ignoran invisibles

10) Export / Import

Export:

descarga recuerdos.json desde GET ?download=1

Import:

subes JSON

manda {action:"import", items} por POST al PHP

PHP deduplica por _id

JS recarga con loadMemories() para reconstruir part√≠culas y tokens